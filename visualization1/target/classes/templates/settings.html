<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <title>System</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel='icon' th:href="@{/image/title.png}"/>
    <script src="/webjars/echarts/4.0.4/dist/echarts.js"></script>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script th:src="@{/js/ScrollReveal.js}"></script>
    <style>

        .log-out-base {
            margin-right: 15px;
            text-decoration: none;
        }

        .log-out:hover {
            margin-right: 15px;
            color: #ffc107 !important;
            text-decoration: none;
        }

        .Subhead-heading {
            flex: 1 1 auto;
            font-size: 24px;
            font-weight: 400;
        }

        footer {
            padding: 24px 40px 24px 40px !important;
            font-size: 14px;
            margin-top: 40px;
            background-color: rgba(0, 0, 0, .05) !important;
            display: flex;
        }

        footer ul {
            list-style: none;
            margin-bottom: 0px !important;
        }

        .danger-border {
            border-radius: 5px;
            border-width: 1px;
            border-color: #d73a49;
            border-style: solid;
        }
    </style>
</head>

<body>
<section>
    <nav class="navbar navbar-expand-sm navbar-light bg-white">
        <a class="navbar-brand" href="#" style="font-size: 30px!important;">
            <img th:src="@{/image/title.png}" width="49" height="40"
                 class="d-inline-block align-top" alt="">
            System
        </a>
        <button class="navbar-toggler d-lg-none" type="button" data-toggle="collapse"
                data-target="#collapsibleNavId" aria-controls="collapsibleNavId" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="collapsibleNavId">
            <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                <li class="nav-item">
                    <a class="nav-link font-menu-item" href="/main">职业分析</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link font-menu-item" href="/house">住房分析</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link font-menu-item" href="/district">详细数据</a>
                </li>
            </ul>
            <div class="style-when-login-in">
                <a href="login.html" class="log-out log-out-base">
                    <span>Log out</span>
                </a>
                <a href="#" style="min-width: 40px;height: 40px!important;">
                    <img th:src="@{/image/title.png}" alt="" class="rounded-circle"
                         style="margin-right:20px;;max-width: 38px;max-height: 38px;">
                </a>
            </div>
        </div>

    </nav>
</section>
<div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Something you should concern</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="words">
                Your input format is illegal, the password an username should start with english characters and
                only contains numbers, !. And also less than 25 characters and more than 6 characters.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">OK,I know</button>
            </div>
        </div>
    </div>
</div>
<!-- 这是container部分 -->
<section style="margin-top: 0px!important;">
    <div style="background-color: #fafbfc;margin: 0px;">
        <div>
            <div class="container">

                <img src="" alt=""/>
                <h3 style="max-width: 1140px;padding-bottom: 20px;">
                        <span th:text="${session.username}">
                            abc
                        </span></h3>

                <nav style="margin-bottom: 20px;">
                    <div class="nav nav-tabs" id="nav-tab" role="tablist">
                        <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-home"
                           role="tab" aria-controls="nav-home" aria-selected="true">Home</a>
                        <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-profile"
                           role="tab" aria-controls="nav-profile" aria-selected="false">Profile</a>
                        <a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#nav-contact"
                           role="tab" aria-controls="nav-contact" aria-selected="false">Contact</a>
                    </div>
                </nav>
            </div>
        </div>

    </div>
    <div class="container">

        <div class="row">
            <div id="options" class="col-lg-3 col-md-3">
                <ul class="list-group">
                    <li class="list-group-item active"><a id="settings_btn" href="#settings"
                                                          style="color: white!important;text-decoration: none;">Settings</a>
                    </li>
                    <li class="list-group-item"><a id="pw_btn" href="#password"
                                                   style="color:#212529; text-decoration: none;">Password</a>
                    </li>
                    <li class="list-group-item"><a id="dz_btn" href="#danger_zone"
                                                   style="color:#212529; text-decoration: none;">Danger
                        Zone</a>
                    </li>
                </ul>
            </div>
            <div id="infos" class="col-lg-9 col-md-9">
                <h4 class="col-lg-4 col-md-4 Subhead-heading">Settings</h4>
                <hr/>

                <label style="font-weight: 600;" class="col-lg-4 col-md-4">Username</label>
                <form class="form-inline" style="margin-left: 20px;margin-bottom: 10px;">
                    <div class="form-group">
                        <input type="text" class="form-control lg-12 md-12" id="username" value="abc"
                               th:value="${session.username}">
                    </div>
                    <button type="submit" class="btn btn-primary md-3 lg-3 ml-4" onclick="checkUsername()">Rename
                    </button>
                </form>
                <small id="usernameHelper" class="text-muted" style="margin-left: 20px;padding-top: 10px;">We'll never
                    share
                    your email with anyone
                </small>

                <div>
                    <hr style="margin: 10px 100px 10px 30px;"/>

                    <label style="font-weight: 600;" class="col-lg-4 col-md-4">Password</label>
                    <form class="form-inline" style="margin-left: 20px; margin-bottom: 10px;">
                        <div class="form-group">
                            <input type="password" class="form-control lg-12 md-12" id="inputPassword2"
                                   value="pasiloishfz">
                        </div>
                        <button type="submit" id="changePassword" class="btn btn-primary md-3 lg-3 ml-4"
                                onclick="return false">Confirm
                        </button>
                    </form>
                    <div style="display: inline;">
                        <small id="emailHelp" class="text-muted" style="margin-left: 20px;">This will change your
                            password
                        </small>
                    </div>
                </div>
                <hr/>
                <div>
                    <h2 id="danger_zone" class="col-lg-4 col-md-4 Subhead-heading"
                        style="padding: 0px 0px 8px;margin: 30px 0px 0px;">
                        Danger Zone</h2>
                    <div class="danger-border">
                        <div class="d-flex flex-items-center" style="padding: 14px;">
                            <div>
                                <strong class="mb-2">Delete your account</strong>
                                <p class="pr-6 mb-0">By clicking this you will delete your account. And you
                                    wouldn't be able to use our system.</p>
                            </div>
                            <div style="margin-top: 5px;" class="ml-auto">
                                <a th:href="'/delete/'+${session.username}" class="btn btn-danger mr-5">
                                    Delete
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>


<footer>
    <div th:replace="footer"></div>
</footer>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.js">
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous">
</script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous">
</script>
<script>
    window.sr = ScrollReveal()
    sr.reveal('h3', {
        duration: 1800,
        origin: 'top',
        distance: '200px'
    })
    sr.reveal('.navbar', {
        duration: 1800,
        origin: 'top',
        distance: '100px'
    })
    sr.reveal('#infos', {
        duration: 2000,
        origin: 'right',
        distance: '100px'
    })
    sr.reveal('#options', {
        duration: 2000,
        origin: 'left',
        distance: '100px'
    })
    sr.reveal('#copyright', {
        duration: 1000,
        origin: 'bottom',
        distance: '20px'
    })
    sr.reveal('#icons', {
        duration: 1000,
        origin: 'bottom',
        distance: '20px'
    })
</script>
<script>
    var active_position = $("#settings_btn") // 初试条件下 active的按钮为第一个
    var btn_list = ['#dz_btn', '#settings_btn', '#pw_btn']

    // 将传入的button设置为不活跃
    function resetActive() {
        active_position.parent(".list-group-item").removeClass("active")
        active_position.css("color", "#212529")
    }

    // 将传入的button设置为活跃
    function setActive(btn) {
        btn.parent('.list-group-item').addClass("active")
        btn.css("color", "white")
    }

    // 替换活跃的button
    function change(btn) {
        setActive(btn)
        resetActive()
        active_position = btn
    }

    $("#changePassword").click(function () {
        console.log('start...')
        var a = $("#inputPassword2").val()
        $.ajax("/chpasswd", {
            method: 'POST',
            data: 'newPassword=' + a,
            success: function (data) {
                console.log('success...')
                if (data === 'FATAL') {
                    $('#words').text("New Password can not be empty!")
                    $('#modal').modal('show')
                } else if (data === 'SUCCESS') {
                    $('#words').text("Password change successful!");
                    $('#modal').modal('show')
                } else if(data === 'OFFLINE'){
                    window.location = "/login"
                }
            }
        })
    })

    // 给Danger Zone按钮添加事件监听器
    $("#dz_btn").click(function () {
        let a = $("#dz_btn")
        if (a.get(0) !== active_position.get(0)) {
            change(a)
        }
    })

    $('#pw_btn').click(function () {
        let a = $('#pw_btn')
        if (a.get(0) !== active_position.get(0)) {
            change(a)
        }
    })

    // 给settings按钮添加事件监听器
    $("#settings_btn").click(function () {
        let a = $("#settings_btn")
        if (a.get(0) !== active_position.get(0)) {
            change(a)
        }
    })
</script>
</body>

</html>